---
title: Effect of different dwarfing genes on wheat yield traits
subtitle: 
short_title:  # Delete if not required

author:  Brenton Brooks
affiliation: Ag and Food # Or group/team
photo: resources/img/Sheaf.jpg

output: DSreport::project_summary
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  results = 'asis',
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = 'center'
)

#Load libraries
library(tidyverse)
library(gapminder)
library(kableExtra)
library(lubridate)
library(cowplot)
#test
```


# Introduction
Introduce *yourself*. What's your background? Could you code before Data School? What did your 
daily work pattern look like before Data School? Etc. This section will be placed in 
an introductory block at the top of the page separate from the rest of the content. Don't change the section title from "Introduction" otherwise this process won't work correctly.

# My Project
Rather than yourself, this is the space to introduce your **project**. What are 
your goals, what is your data, how do you plan to work with it? Perhaps show some example data if 
it would help.



## Preliminary results

This section will demonstrate the different visuals you might want use to show off your 
project. Don't feel the need to go overboard, this is supposed to give a taste of the work you are
doing rather than being a publication ready document.


```{r read data}

beauties2017 <- read_csv('data/beauties2017.csv') #loading your data file
# head(beauties2017)

# determine mean of reps

beauties_summary <- beauties2017 %>% 
  select(entry, 10:19) %>% 
  group_by(entry) %>% 
  summarise_all(mean, na.rm = TRUE) # remove NA to estimate mean of reps 

beauties_raw <- beauties2017 %>% 
  select(-c(10:19), -REP, -row, -range) %>% 
  left_join(beauties_summary, by="entry") %>% 
  distinct()

```

**Tables**

```{r mytable, out.width='100%', echo = F}
knitr::kable(head(beauties_summary, n = 5), format = "html", caption = "Example of data measured for each trait") %>% 
  kable_styling("striped")

```

```{r}

#gather and spread
#tidy is a rectangular data - 2 dimensions i.e. rows and columns
#if, say, traits names are column names - wide format data - as you add
#new variable, the data becomes wider
#long format is in its simplicity a pair-wise data
#for your data you will have 72x9 number of rows
#spread makes data wider
#gather makes data long

#functions - anything that follows () is a function ##generalisation - CAREFUL

beauties_raw <- beauties_raw %>% 
  select(genotype, rhtmajor, rhtminor, 9:18) %>% #select variable columns with data
  group_by(genotype, rhtmajor, rhtminor) %>% # group rht gene combo
  summarise_all(mean) # calculate mean for each variety's gene combo
  
beauties_raw <- beauties_raw %>% 
  mutate(group = paste(rhtmajor, rhtminor, sep = "_")) #groups gene combo label



```

```{r yield by QTL}

yield <- beauties_raw %>% 
  filter(!genotype %in% c("C6", "Sceptre", "Shield")) %>% # drop these var
  ggplot() +
  geom_boxplot(aes(x = reorder(group, desc(yieldkgm2)), y = yieldkgm2))+
  #facet_wrap(~genotype, scales = "free_x", nrow = 1)+
   theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 8)) +
   labs(title="Plot yield response to height QTL combination", x = "QTL combination", y = "Grain Yield (kg)")

yield


```


```{r plot1, fig.cap="Flowering time"}

headplot <- beauties_raw %>% 
  filter(!genotype %in% c("C6", "Sceptre", "Shield")) %>% # drop these var
  pivot_longer(cols = c(Z20170920, Z20170926), names_to = "Z_date", values_to = "Z_score") %>% # make long 
  mutate(Z_date=str_sub(string = Z_date, 2, -1)) %>% # -1 is last character
  mutate(Z_date=ymd(Z_date)) %>% # make it a real date
  ggplot(aes(x = group, y = Z_score)) +
  geom_point(aes(colour= as.factor(Z_date)))+
  facet_wrap(~genotype, scales = "free_x", nrow = 1)+
   theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 8)) +
   labs(title="Heading score on two dates for varieties and their QTLs", x = "QTL combination", y = "Zadoks Score", colour = "Date") +
  theme(legend.position = "bottom")
# +
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 5),
#         plot.title = (element_text(size=10, hjust = 0.5)),
#         panel.grid.minor.x  = element_blank(),
#         axis.text.y = element_text(size = 5),
#          axis.title = element_text(size = 8))

  

headplot

```



```{r yield by genotype}

yield_gen <- beauties_raw %>% 
  filter(!genotype %in% c("C6", "Sceptre", "Shield")) %>% # drop these var
  ggplot() +
  geom_point(aes(x = group, y = yieldkgm2))+
  facet_wrap(~genotype, scales = "free_x", nrow = 1)+
   theme_bw() +
  theme(axis.text.x = element_blank()) +
   labs(title="Plot yield", x="", y = "Grain Yield")

yield_gen


```

```{r biomass by QTL}

biomass <- beauties_raw %>% 
  filter(!genotype %in% c("C6", "Sceptre", "Shield")) %>% # drop these var
  ggplot() +
  geom_boxplot(aes(x = reorder(group, desc(bm)), y = bm))+
  #facet_wrap(~genotype, scales = "free_x", nrow = 1)+
   theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 8)) +
   labs(title="Biomass Z89 response to height QTL combination", x = "QTL combination", y = "Biomass (g)")

# biomass

```


```{r HI}

hi <- beauties_raw %>% 
  filter(!genotype %in% c("C6", "Sceptre", "Shield")) %>% # drop these var
  ggplot(aes(x = group, y = HI)) +
  geom_point()+
  facet_wrap(~genotype, scales = "free_x", nrow = 1)+
   theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 8)) +
   labs(title="Harvest Index", x = "QTL combination", y = "HI")

# hi


```


```{r}
tiller <- beauties_raw %>% 
  filter(!genotype %in% c("C6", "Sceptre", "Shield")) %>% # drop these var
  ggplot(aes(x = group, y = tillerperm2)) +
  geom_point()+
  facet_wrap(~genotype, scales = "free_x", nrow = 1)+
   theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 8)) +
   labs(title="Tillering", x = "QTL combination", y = "Tillers m2")

# tiller
```

```{r}

earl <- beauties_raw %>% 
  filter(!genotype %in% c("C6", "Sceptre", "Shield")) %>% # drop these var
  ggplot(aes(x = group, y = earlgthcm)) +
  geom_point()+
  facet_wrap(~genotype, scales = "free_x", nrow = 1)+
   theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 8)) +
   labs(title="Ear size", x = "QTL combination", y = "Ear length cm")

# earl
```

```{r}

rnn <- beauties_raw %>% 
  filter(!genotype %in% c("C6", "Sceptre", "Shield")) %>% # drop these var
  ggplot(aes(x = group, y = RNN)) +
  geom_point()+
  facet_wrap(~genotype, scales = "free_x", nrow = 1)+
   theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 8)) +
   labs(title="Rachis number", x = "QTL combination", y = "RNN")

# rnn


```

```{r plot8, fig.cap="Last"}

klwt <- beauties_raw %>% 
  filter(!genotype %in% c("C6", "Sceptre", "Shield")) %>% # drop these var
  ggplot(aes(x = group, y = kwt)) +
  geom_point()+
  facet_wrap(~genotype, scales = "free_x", nrow = 1)+
   theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size = 8)) +
   labs(title="Grain Size", x = "QTL combination", y = "200 kwt")

# klwt


```

```{r to do cowplot}

plot_grid(yield_gen, hi, tiller, earl, rnn, klwt)
          

```



```{r regression ear length and tillers}

corr_ear_till <- ggplot(beauties2017, aes(x= tillerperm2, y = earlgthcm)) +
  geom_point(aes(colour = as.factor(genotype), size=kwt)) +
  geom_smooth(method = "lm")+ # linear model, grey line is sd
  theme_classic() +
  labs(title="Ear length as response to tillers per m2", x= "Tillers per m2", y = "Ear length cm", colour = "Variety")  # add these in
  


# corr_ear_till

```


```{r reg seed wt and yield by genotype}

reg_sdwt_yld <- ggplot(beauties2017, aes(x= kwt, y =  yieldkgm2)) +
  geom_point(aes(colour = as.factor(genotype), size = RNN)) +
  geom_smooth(method = "lm")+ # linear model, grey line is sd
  theme_classic() +
  labs(title="Kernel wt and yield", x = "Kernel weight g", y = "Yield (kgm2)", colour = "Variety")


# reg_sdwt_yld

```

```{r reg biomass and yield by genotype}

reg_bm_yld <- ggplot(beauties_raw, aes(x= bm, y =  yieldkgm2)) +
  geom_point(aes(colour = as.factor(group), size = htcm)) +
  geom_smooth(method = "lm")+ # linear model, grey line is sd
  theme_classic() +
  labs(title="Biomass and yield", x = "Biomass at Z89 (g)", y = "Yield (kgm2)", colour = "QTL") +
  theme(legend.text = element_text(size=5),
        legend.title = element_text(size = 7),
        legend.key.size = unit(0.2,"cm"),
        legend.box = "horizontal",
        legend.position = c(.65,0.8),
        legend.direction = "horizontal")


reg_bm_yld

```



```{r reg seed wt and yield by QTL}

corr_sdwt_yld <- ggplot(beauties_raw, aes(x= kwt, y =  yieldkgm2)) +
  geom_point(aes(colour = as.factor(group), size = RNN)) +
  geom_smooth(method = "lm")+ # linear model, grey line is sd
  theme_classic() +
  labs(title="Kernel wt and yield", x = "Kernel weight g", y = "Yield (kgm2)", colour = "QTL") 


# corr_sdwt_yld

```

```{r cowplot of regressions, fig.align='center', fig.height= 3, fig.width=8}

plot_grid(reg_sdwt_yld, corr_sdwt_yld)

```

```{r, out.width='100%', fig.align='center', fig.height= 3, fig.width=8}

plot_grid(corr_ear_till, reg_bm_yld)

```



**Images from a file**

![](resources/img/tidyverse.png){width=100px} ![](resources/img/lubridate.jpg){width=100px}
![](resources/img/cowplot.png){width=100px} ![](resources/img/Rmarkdown.png){width=100px}


**Plots from R**
```{r standard-plot, out.width='60%', fig.align='center', fig.height= 4, fig.width=6, fig.cap="Yet another gapminder plot"}
gapminder %>% 
  filter(year == 1987) %>% 
  ggplot(aes(x = gdpPercap, y = lifeExp, colour = continent, size = pop)) +
  geom_point() +
  scale_x_log10(labels = function(b) format(b, scientific = F)) +
  scale_size(trans = "sqrt", guide = "none") +
  scale_color_brewer(palette = "Set1") +
  theme_linedraw() +
  theme(legend.position = "bottom")
```

Your figure and table captions are automatically numbered and can be referenced in the text
if needed: see eg. Table \@ref(tab:mytable) and Figure \@ref(fig:standard-plot)

# My Digital Toolbox

What digital tools have you been using in your project? Do you expect that everything will be able 
to be completed within R, or will you need to work with multiple tools to get the right result?
Which of the digital skills needed for your project have you learned since starting Data School?

You can use all the usual R markdown features in writing a project summary, including lists:

* R - dplyr, ggplot, ...
* Python
* SQL

## Favourite tool (optional)

Is there a tool/package/function in particular that you've enjoyed using? Give it a special shout out here. What about this tool makes it your favourite?

![](https://raw.githubusercontent.com/tidyverse/ggplot2/master/man/figures/logo.png){.pull-right width=100px}

No prizes for guessing mine:

# My time went ...

What parts of your project take the most time and effort? Were there any surprising challenges you
encountered, and how did you solve them?

# Next steps

I would add the data taken in subsequent years to identify interactions, and plot a PCA analysis.

# My Data School Experience

This summary is mostly about your project. However we would also like to hear about other
parts of your Data School experience. What aspects of the program did you really enjoy? Have you
tried applying the skills you have learned in your daily work? Have you been able to transfer this 
knowledge to your team members? Any descriptions of the personal impact the program has 
had are welcome here as well!
